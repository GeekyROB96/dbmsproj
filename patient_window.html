<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Patient Window</title>
  <style>
    /* Add some basic styles for the appointment cards */
    .appointment-card {
      border: 1px solid #ccc;
      padding: 10px;
      margin: 10px;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    }

    .diagnosis-btn {
      background-color: red;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .diagnosis-btn:hover {
      background-color: darkred;
    }
  </style>
</head>

<body>
  <div id="patientDetails">
    <h2>Patient Details</h2>
    <p>Name: <span id="patientName"></span></p>
    <p>Email: <span id="patientEmail"></span></p>
    <p>Phone: <span id="patientPhone"></span></p>
    <p>Address: <span id="patientAddress"></span></p>
  </div>

  <div id="appointments">
    <h2>Appointments</h2>
    <!-- This section will be filled with appointment cards dynamically -->
  </div>


<script>
  // Retrieve the patient details from session storage
  var patientDetails = JSON.parse(sessionStorage.getItem('patientDetailss'));

  // Log the patient details to the console
  console.log('Patient Details:', patientDetails);

  // Display the patient details on the page
  if (patientDetails) {
    // Update the HTML elements with patient details using the correct case
    document.getElementById('patientName').innerText = patientDetails.PatientName;
    document.getElementById('patientEmail').innerText = patientDetails.PatientEmail;
    document.getElementById('patientPhone').innerText = patientDetails.ContactNo;
    document.getElementById('patientAddress').innerText = patientDetails.Address;

    // Fetch and display appointments
    fetch('http://localhost:3000/appointment/appointment/all')
      .then(response => response.json())
      .then(appointments => {
        renderAppointments(appointments.appointments);
      })
      .catch(error => console.error('Error fetching appointments:', error));
  }

  function renderAppointments(appointments) {
    var appointmentsContainer = document.getElementById('appointments');

    if (appointments && appointments.length > 0) {
      appointments.forEach(appointment => {
        // Create appointment card
        var appointmentCard = document.createElement('div');
        appointmentCard.className = 'appointment-card';

        // Display appointment details
        appointmentCard.innerHTML = `
          <p>ID:${appointment.id}</p>
          <p>Appointment id: ${appointment.AppointmentId}</p>
          <p>Patient Name: ${appointment.PatientId}</p>
          <p>Appointment Date: ${appointment.AppointmentDate}</p>
          <p>Appointment Time: ${appointment.AppointmentTime}</p>
          <p>Symptoms: ${appointment.Symptoms}</p>
          <p>Remarks: ${appointment.Remarks}</p>
          <p>Diagnosis: ${appointment.Diagnosis || 'Not available'}</p>
          <!-- Add a button for Diagnosis with a click event -->
          <button class="diagnosis-btn" onclick="navigateToReport(${appointment.id})">Diagnosis Report</button>
        `;

        // Append card to the container
        appointmentsContainer.appendChild(appointmentCard);

        // Add click event listener to the Diagnosis button
        var diagnosisBtn = appointmentCard.querySelector('.diagnosis-btn');
        diagnosisBtn.addEventListener('click', function () {
          // Print some text to the console when the button is clicked
          console.log('Diagnosis button clicked for appointment:', appointment.AppointmentId);
        });
      });
    } else {
      console.log('No appointments found.');
      appointmentsContainer.innerHTML = '<p>No appointments found.</p>';
    }
  }
  function navigateToReport(id){
    console.log("Navigating to report for appointment id: " ,id);
    sessionStorage.setItem("selectedID",id);
    window.location.href='report.html';
    }
</script>



  
</body>

</html>
